\documentclass[ngerman]{dtk}
\ifluatex\else
\usepackage[utf8]{inputenc}
%\usepackage[latin9]{inputenc}
\fi
\usepackage{siunitx}
%\usepackage{etoolbox}
%\usepackage{keyval}
\usepackage{cleveref}




%----------------------
\newcommand{\catalogueentry}[1]{%
\RaggedRight 
\setkeys{catalogue}{#1}%
\ifdef{\KVhouse}{\section{\KVhouse
			\ifdef{\KVlabel}{\label{\KVlabel}}{}}
			}{}%
\begin{labeling}{Beschreibung}
%	\footnotesize %
%	\setlength{\itemsep}{0pt}%
%    \setlength{\parskip}{0pt}%
%    \setlength{\parsep}{0pt}%
\ifdef{\KVdescription}{\item[Beschreibung] \KVdescription}{}%
\ifdef{\KVlocation}{\item[Verortung] \KVlocation}{}%
\ifdef{\KVinterior}{%
	\item[Ausstattung] \KVinterior %
	\ifboolexpr{bool{@KVinteriorM} or bool {@KVinteriorW} or bool {@KVinteriorS}}{%
	\begin{labeling}{Wandgemälde}
%		\setlength{\itemsep}{0pt}%
%    		\setlength{\parskip}{0pt}%
%    		\setlength{\parsep}{0pt}%
			\ifdef{\KVinteriorM}{\item[Mosaike] \KVinteriorM}{}
			\ifdef{\KVinteriorW}{\item[Wandgemälde] \KVinteriorW}{}
			\ifdef{\KVinteriorS}{\item[Statuen] \KVinteriorS}{}
			\end{labeling}
		}{}}%
	{%
	\ifboolexpr{bool{@KVinteriorM} or bool {@KVinteriorW} or bool {@KVinteriorS}}{%
		\item[Ausstattung]%
	\begin{labeling}{Wandgemälde}	
%			\setlength{\itemsep}{0pt}
%	 		\setlength{\parskip}{0pt}%
%    			\setlength{\parsep}{0pt}%
				\ifdef{\KVinteriorM}{\item[Mosaike] \KVinteriorM}{}
				\ifdef{\KVinteriorW}{\item[Wandgemälde] \KVinteriorW}{}
				\ifdef{\KVinteriorS}{\item[Statuen] \KVinteriorS}{}
			\end{labeling}
	}{}}%
\ifdef{\KVsize}{	\item[Größe] \SI{\KVsize}{\meter\squared}}{}%
\ifdef{\KVliterature}{\item[Erwähnungen] \KVliterature}{}%		
\end{labeling}
}

\makeatletter
\newbool{@KVinteriorM}%Mosaik
\newbool{@KVinteriorW}%Wandgemälde
\newbool{@KVinteriorS}%Statue
\define@key{catalogue}{house}{\def\KVhouse{#1}}
\define@key{catalogue}{label}{\def\KVlabel{#1}}
\define@key{catalogue}{description}{\def\KVdescription{#1}}
\define@key{catalogue}{location}{\def\KVlocation{#1}}
\define@key{catalogue}{size}{\def\KVsize{#1}}
\define@key{catalogue}{interior}{\def\KVinterior{#1}}%Innenausstattung
\define@key{catalogue}{interiorM}{\def\KVinteriorM{#1}\booltrue{@KVinteriorM}}
\define@key{catalogue}{interiorW}{\def\KVinteriorW{#1}\booltrue{@KVinteriorW}}
\define@key{catalogue}{interiorS}{\def\KVinteriorS{#1}\booltrue{@KVinteriorS}}
\define@key{catalogue}{literature}{\def\KVliterature{#1}}
\makeatother


\begin{document}
\title{Integration von Python in \LaTeX\ am Beispiel von Katalogeinträgen}
\Author{Uwe}{Ziegenhagen}{}
\Author{Lukas C.}{Bossert}%
			{Cranachstr.~24\\
			12157 Berlin\\
			\Email{lukas@digitales-altertum.de}}
\maketitle



Viele Dissertationen in der Archäologie enthalten am Ende der Arbeit einen Katalog, 
in dem die untersuchten Daten in einem bestimmten System aufgeschlüsselt präsentiert werden.
Ein solcher Katalog kann aus  Bildern, Bohrproben, Architekturen etc. bestehen.

Eine händische Erstellung der einzelnen Einträge bspw. über \Macro{section} oder \Macro{subsection} 
und anschließend in einer \Environment{items}-Umgebung ist nicht effizent, fehleranfällig und nur bei wenigen Katalogeinträgen einsetzbar.
Es muss zudem berücksichtigt werden, dass nicht auf alle Katalogeinträge alle vorgegebene Kategorien passen, 
sodass  Kategorien leer bleiben  und dann im Katalogeintrag nicht auftauchen sollen.
Dabei soll der Code möglichst viel redundante Tipp-Arbeit abnehmen,
wie sie bspw. bei Maßeinheiten vorkommt.
Darüberhinaus sollen alle Einträge immer gleich formatiert sein und ihr Aussehen global verändert werden können.

Nachdem  eine  Lösung gefunden wurde, die allen bisher genannten Anforderungen entspricht (siehe unten),
sollte in einer Kategorie alle Seitenzahlen enthalten, auf denen der Katalogeintrag im Haupttext erwähnt wurde.
Ein  Lösungsansatz sah die Nutzung von  \Package{glossaries} vor: 
Dafür musste allerdings für jeden Katalogeintrag ein eigenes Glossar angelegt werden, was nicht nur viel händische Arbeit bedeutet,
sondern auch die Zählerkapazitäten von \TeX überforderten.

Es musste also eine andere Lösung her und ich (Lukas) erinnerte mich an einen Beitrag, den Uwe Ziegenhagen in dtk 1/2015 vorgestellt hatte:
Damals ging es darum, bei einem Werkkatalog die Erwähnung des Stückes im Haupttext anzugeben. 
Prima, genau das, was ich gesucht habe und ich fand den damals verwendeten Code auf seiner Webseite.\footnote{\url{http://uweziegenhagen.de/?p=3020}}
Allerdings  sah ich nun, dass die Aufgabe  damals darin bestand, nur \emph{eine} Erwähnung im dem Haupttext anzugeben,
was mit \Command{label} und \Command{ref{}} bewerkstelligt werden konnte.
Ich brauche jedoch alle Erwähnungen im Haupttext.
Meine Emailanfrage bei Uwe nach einer Möglichkeit mehr als nur eine Erwähnung anzeigen zu lassen,
beantwortete er mit dem Vorschlag mittels Python das Problem zu lösen.

Um gemeinsam an dem hybriden Konstrukt von LaTeX und Python wurde ein Repository auf der Plattform \Program{github}\footnote{\url{https://github.com/LukasCBossert/DTK-TeX-Python}} erstellt, 
die unabhängig der Programmiersprache einen exzellenten Austausch und eine detaillierte Versionskontrolle bereithält,
sodass sich kollaboriertes Arbeiten  sehr gut konzipieren lässt. 


\subsection{Katalogeintrag}
Die gewählte Lösung für die Katalogeinträge arbeitet mit dem \Package{keyval}.\footnote{Basierend auf der Idee vorgestellt auf: \url{http://tex.stackexchange.com/a/254336/98739}}
Dafür werden in der Präambel verschiedene \Command{keys} definiert.
In der Grundversion sieht ein Eintrag wie folgt aus:\footnote{Vgl. \url{http://www.tug.org/tugboat/tb30-1/tb94wright-keyval.pdf}}
\begin{lstlisting}[style=noNumber]
\define@key{family}{key}{#1}
\end{lstlisting}

Für das konkrete Beispiel wird die \Command{key}-Familie (\Command{family}) mit \Command{catalogue} angegeben,
der Schlüssel (Kategorie im Katalog) als \Command{house} bezeichnet und als Resultat soll der Wert im Makro \Macro{KVhouse} gespeichert werden:
\begin{lstlisting}[style=noNumber]
\define@key{catalogue}{house}{\def\KVhouse{#1}}
\end{lstlisting}
Entsprechend dieses Beispiels können alle Kategorien als Schlüssel angelegt werden:
\begin{lstlisting}[style=number]
\makeatletter
\define@key{catalogue}{house}{\def\KVhouse{#1}}
\define@key{catalogue}{label}{\def\KVlabel{#1}}
\define@key{catalogue}{description}{\def\KVdescription{#1}}
\define@key{catalogue}{location}{\def\KVlocation{#1}}
\define@key{catalogue}{size}{\def\KVsize{#1}}
\define@key{catalogue}{interior}{\def\KVinterior{#1}}
\define@key{catalogue}{interiorM}{\def\KVinteriorM{#1}}
\define@key{catalogue}{interiorW}{\def\KVinteriorW{#1}}
\define@key{catalogue}{interiorS}{\def\KVinteriorS{#1}}
\define@key{catalogue}{literature}{\def\KVliterature{#1}}
\makeatother
\end{lstlisting}
Das Aussehen eines Katalogeintrages wird separat in einem \Macro{newcommand} definiert.
\begin{lstlisting}[style=number]
\newcommand{\catalogueentry}[1]{%
\RaggedRight 
\setkeys{catalogue}{#1}
\end{lstlisting}


\begin{lstlisting}[style=number]
\newcommand{\catalogueentry}[1]{%
\RaggedRight 
\setkeys{catalogue}{#1}%
\ifdef{\KVhouse}{\section{\KVhouse
			\ifdef{\KVlabel}{\label{\KVlabel}}{}}
			}{}%
\begin{labeling}{Beschreibung}
\ifdef{\KVdescription}{\item[Beschreibung] \KVdescription}{}%
\ifdef{\KVlocation}{\item[Verortung] \KVlocation}{}%
\ifdef{\KVinterior}{%
	\item[Ausstattung] \KVinterior %
	\ifboolexpr{bool{@KVinteriorM} or bool {@KVinteriorW} or bool {@KVinteriorS}}{%
	\begin{labeling}{Wandgemälde}
			\ifdef{\KVinteriorM}{\item[Mosaike] \KVinteriorM}{}
			\ifdef{\KVinteriorW}{\item[Wandgemälde] \KVinteriorW}{}
			\ifdef{\KVinteriorS}{\item[Statuen] \KVinteriorS}{}
			\end{labeling}
		}{}}%
	{%
	\ifboolexpr{bool{@KVinteriorM} or bool {@KVinteriorW} or bool {@KVinteriorS}}{%
		\item[Ausstattung]%
	\begin{labeling}{Wandgemälde}	
				\ifdef{\KVinteriorM}{\item[Mosaike] \KVinteriorM}{}
				\ifdef{\KVinteriorW}{\item[Wandgemälde] \KVinteriorW}{}
				\ifdef{\KVinteriorS}{\item[Statuen] \KVinteriorS}{}
			\end{labeling}
	}{}}%
\ifdef{\KVsize}{	\item[Größe] \SI{\KVsize}{\meter\squared}}{}%
\ifdef{\KVliterature}{\item[Erwähnungen] \KVliterature}{}%		
\end{labeling}
}
\end{lstlisting}


\begin{lstlisting}[style=number]
\catalogueentry{%
	house={Haus des M. Fabius Rufus},
	label={haus:M-Fabius-Rufus},
	size={172},
	description={Haus besteht aus mehreren Einzelgebäuden.},
	location={Regio VII, Insula 16, Eingang 17--22.},
	interior={Reicher Fundkomplex.},
	interiorM={S/W-Mosaik},
	interiorW={Dionysius mit einer Mänade, Narzissus und ein Cupido, Hercules und Deinira, etc.},
	interiorS={Bronzene Statue eines Epheben},
}
\end{lstlisting}


\catalogueentry{%
	house={Haus des M. Fabius Rufus},
	label={haus:M-Fabius-Rufus},
	size={172},
	description={Haus besteht aus mehreren Einzelgebäuden.},
	location={Regio VII, Insula 16, Eingang 17--22.},
	interior={Reicher Fundkomplex.},
	interiorM={S/W-Mosaik},
	interiorW={Dionysius mit einer Mänade, Narzissus und ein Cupido, Hercules und Deinira, etc.},
	interiorS={Bronzene Statue eines Epheben},
}
\newpage
Weiteres Beispiel mit teilweiser Innenausstattung:










\begin{lstlisting}[style=number]
\catalogueentry{%
	house={Haus des Wilden Ebers},
	label={haus:Wilden-Ebers},
	size={54},
	description={Renovierung nach Erdbeben 62\,n.\,Chr.},
	location={Regio VII, Insula 4, Eingang 48, 43},
	interiorM={S/W-Mosaik},
	interiorW={Venus, Leda und der Schwan, Ariadne und Theseus},
}
\end{lstlisting}

\catalogueentry{%
	house={Haus des Wilden Ebers},
	label={haus:Wilden-Ebers},
	size={54},
	description={Renovierung nach Erdbeben 62\,n.\,Chr.},
	location={Regio VII, Insula 4, Eingang 48, 43},
	interiorM={S/W-Mosaik},
	interiorW={Venus, Leda und der Schwan, Ariadne und Theseus},
}


\newpage
Notwendige Pakete
\begin{lstlisting}[style=noNumber]
\usepackage{etoolbox}
\usepackage{keyval}
\usepackage{cleveref}
\usepackage{siunitx}
\end{lstlisting}

\begin{lstlisting}[style=number]
\newcommand{\catalogueentry}[1]{%
\begingroup\RaggedRight 
\setkeys{catalogue}{#1}%
\ifdef{\KVhouse}{\section{\KVhouse
			\ifdef{\KVlabel}{\label{\KVlabel}}{}}
			}{}%
\begin{labeling}{Beschreibung}
\ifdef{\KVdescription}{\item[Beschreibung] \KVdescription}{}%
\ifdef{\KVlocation}{\item[Verortung] \KVlocation}{}%
\ifdef{\KVinterior}{%
	\item[Ausstattung] \KVinterior %
	\ifboolexpr{bool{@KVinteriorM} or bool {@KVinteriorW} or bool {@KVinteriorS}}{%
	\begin{labeling}{Wandgemälde}
			\ifdef{\KVinteriorM}{\item[Mosaike] \KVinteriorM}{}
			\ifdef{\KVinteriorW}{\item[Wandgemälde] \KVinteriorW}{}
			\ifdef{\KVinteriorS}{\item[Statuen] \KVinteriorS}{}
			\end{labeling}
		}{}}%
	{%
	\ifboolexpr{bool{@KVinteriorM} or bool {@KVinteriorW} or bool {@KVinteriorS}}{%
		\item[Ausstattung]%
	\begin{labeling}{Wandgemälde}	
				\ifdef{\KVinteriorM}{\item[Mosaike] \KVinteriorM}{}
				\ifdef{\KVinteriorW}{\item[Wandgemälde] \KVinteriorW}{}
				\ifdef{\KVinteriorS}{\item[Statuen] \KVinteriorS}{}
			\end{labeling}
	}{}}%
\ifdef{\KVsize}{	\item[Größe] \SI{\KVsize}{\meter\squared}}{}%
\ifdef{\KVliterature}{\item[Erwähnungen] \KVliterature}{}%		
\end{labeling}
\endgroup
}


\end{lstlisting}



\subsection{python}

\subsection{Integration}



%%\lstinputlisting[style=number,language={[AlLaTeX]{TeX}}]{\jobname.tex}%LCB:Test
\end{document}